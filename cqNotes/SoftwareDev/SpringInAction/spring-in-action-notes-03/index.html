<!DOCTYPE html><html class="hide-aside" lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Spring In Action Notes (3) | ReadingNotes</title><meta name="keywords" content="software_dev,spring"><meta name="author"><meta name="copyright"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Ch6 Working With Configuration Properties Configuration properties are nothing more than properties on @ConfigurationProperties-annotated beans in the Spring application context. Spring will inject va">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring In Action Notes (3)">
<meta property="og:url" content="https://bzhao2718.github.io/reading-notes/cqNotes/SoftwareDev/SpringInAction/spring-in-action-notes-03/index.html">
<meta property="og:site_name" content="ReadingNotes">
<meta property="og:description" content="Ch6 Working With Configuration Properties Configuration properties are nothing more than properties on @ConfigurationProperties-annotated beans in the Spring application context. Spring will inject va">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://bzhao2718.github.io/reading-notes/default_cover/typewriter-801921_1920.jpg">
<meta property="article:published_time" content="2021-10-28T06:25:58.000Z">
<meta property="article:modified_time" content="2021-11-25T19:03:02.720Z">
<meta property="article:tag" content="software_dev">
<meta property="article:tag" content="spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bzhao2718.github.io/reading-notes/default_cover/typewriter-801921_1920.jpg"><link rel="shortcut icon" href="/reading-notes/img/favicon.png"><link rel="canonical" href="https://bzhao2718.github.io/reading-notes/cqNotes/SoftwareDev/SpringInAction/spring-in-action-notes-03/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/reading-notes/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/reading-notes/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Spring In Action Notes (3)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-11-26 03:03:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/hexo-butterfly-tag-plugins-plus@latest/lib/carousel-touch.min.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/reading-notes/archives/"><div class="headline">Articles</div><div class="length-num">90</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/reading-notes/tags/"><div class="headline">Tags</div><div class="length-num">22</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/reading-notes/categories/"><div class="headline">Categories</div><div class="length-num">12</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/reading-notes/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/reading-notes/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/reading-notes/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/reading-notes/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/reading-notes/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/reading-notes/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/reading-notes/">ReadingNotes</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/reading-notes/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/reading-notes/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/reading-notes/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/reading-notes/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/reading-notes/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/reading-notes/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Spring In Action Notes (3)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-10-28T06:25:58.000Z" title="Created 2021-10-28 14:25:58">2021-10-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-11-25T19:03:02.720Z" title="Updated 2021-11-26 03:03:02">2021-11-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/reading-notes/categories/SoftwareDev/">SoftwareDev</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>13min</span></span></div></div></div><article class="post-content" id="article-container"><h1 id="ch6-working-with-configuration-properties">Ch6 Working With Configuration Properties</h1>
<p>Configuration properties are nothing more than properties on <code>@ConfigurationProperties</code>-annotated beans in the Spring application context. Spring will inject values from one of several property sources—including JVM system properties, command-line arguments, and environment variables—into the bean properties.</p>
<h2 id="fine-tuning-autocnofiguration">Fine-tuning autocnofiguration</h2>
<p>It’s important to establish that there are two different (but related) kinds of configurations in Spring:</p>
<ul>
<li>Bean wiring— Configuration that declares application components to be created as beans in the Spring application context and how they should be injected into each other.</li>
<li>Property injection— Configuration that sets values on beans in the Spring application context.</li>
</ul>
<h3 id="understanding-springs-environment-abstraction">Understanding Spring’s environment abstraction</h3>
<p>The Spring environment abstraction is a one-stop shop for any configurable property. It abstracts the origins of properties so that beans needing those properties can consume them from Spring itself. The Spring environment pulls from several property sources, including</p>
<ul>
<li>JVM system properties</li>
<li>Operating system environment variables</li>
<li>Command-line arguments</li>
<li>Application property configuration files</li>
</ul>
<p>It then aggregates those properties into a single source from which Spring beans can be injected.</p>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/reading-notes/cqNotes/SoftwareDev/SpringInAction/spring-in-action-notes-03/ch6-env-abstraction.png" class="" title="The Spring environment pulls properties from property sources and makes them available to beans in the application context.">
<h3 id="configuring-a-data-source">Configuring a data source</h3>
<p>For example, if you were to start using a MySQL database, you might add the following configuration properties to <code>application.yml</code>:</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">datasource:</span></span><br><span class="line">		<span class="attr">url:</span> <span class="string">jdbc:mysql://localhost/tacocloud</span> </span><br><span class="line">		<span class="attr">username:</span> <span class="string">tacouser</span> </span><br><span class="line">		<span class="attr">password:</span> <span class="string">tacopassword</span></span><br></pre></td></tr></tbody></table></figure>
<p>Although you’re explicitly setting server.port to 0, the server won’t start on port 0. Instead, it’ll start on a randomly chosen available port. This is useful when running automated integration tests to ensure that any concurrently running tests don’t clash on a hard-coded port number.</p>
<h3 id="configuring-the-embedded-server">Configuring the embedded server</h3>
<p>But there’s more to the underlying server than just a port. One of the most common things you’ll need to do with the underlying container is to set it up to handle HTTPS requests. To do that, the first thing you must do is create a keystore using the JDK’s keytool command-line utility: <code>keytool -keystore mykeys.jks -genkey -alias tomcat -keyalg RSA</code></p>
<p>Next, you’ll need to set a few properties to enable HTTPS in the embedded server.</p>
<p>With these properties in place, your application should be listening for HTTPS requests on port 8443.</p>
<h3 id="configuring-logging">Configuring logging</h3>
<p>By default, Spring Boot configures logging via Logback ( http://logback.qos.ch) to write to the console at an INFO level.</p>
<h3 id="using-special-property-values">Using special property values</h3>
<p>When setting properties, you aren’t limited to declaring their values as hard-coded String and numeric values. Instead, you can derive their values from other configuration properties.</p>
<p>For example, suppose (for whatever reason) you want to set a property named <code>greeting.welcome</code> to echo the value of another property named <code>spring.application.name</code>. To achieve this, you could use the <code>${}</code> placeholder markers when setting <code>greeting.welcome</code>:</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">greeting:</span></span><br><span class="line">	<span class="attr">welcome:</span> <span class="string">You</span> <span class="string">are</span> <span class="string">using</span> <span class="string">${spring.application.name}.</span></span><br></pre></td></tr></tbody></table></figure>
<p>As you’ve seen, configuring Spring’s own components with configuration properties makes it easy to inject values into those components’ properties and to fine-tune autoconfiguration. Configuration properties aren’t exclusive to the beans that Spring creates. With a small amount of effort, you can take advantage of configuration properties in your own beans.</p>
<h2 id="creating-your-own-confutation-properties">Creating your own confutation properties</h2>
<p>To support property injection of configuration properties, Spring Boot provides the <code>@ConfigurationProperties</code> annotation. When placed on any Spring bean, it specifies that the properties of that bean can be injected from properties in the Spring environment.</p>
<p>Let’s say that you want to limit the number of orders displayed to the most recent 20 orders. You can change <code>ordersForUser()</code></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span> </span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">ordersForUser</span><span class="params">( <span class="meta">@AuthenticationPrincipal</span> User user, Model model)</span> {</span><br><span class="line">	<span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(<span class="number">0</span>, <span class="number">20</span>); model.addAttribute(<span class="string">"orders"</span>,orderRepo.findByUserOrderByPlacedAtDesc(user, pageable));</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"orderList"</span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>along with the corresponding changes to <code>OrderRepository</code>:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Order&gt; <span class="title function_">findByUserOrderByPlacedAtDesc</span><span class="params">( </span></span><br><span class="line"><span class="params">  User user, Pageable pageable)</span>;</span><br></pre></td></tr></tbody></table></figure>
<p><code>Pageable</code> is Spring Data’s way of selecting some subset of the results by a page number and page size. In the <code>ordersForUser()</code> controller method, you constructed a <code>PageRequest</code> object that implemented <code>Pageable</code> to request the first page (page zero) with a page size of 20 to get up to 20 of the most recently placed orders for the user.</p>
<p>Because it’s (the page size) hard-coded, you’d have to rebuild and redeploy the application.</p>
<p>We can add <code>@ConfigurationProperties(prefix="taco.orders")</code> to the <code>OrderController.java</code> class and use a <code>int pageSize=20</code> variable.</p>
<p>The new pageSize property defaults to 20. But you can easily change it to any value you want by setting a taco.orders.pageSize property. You could set this property in <code>application.yml</code> like this:</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">taco:</span></span><br><span class="line">	<span class="attr">orders:</span></span><br><span class="line">		<span class="attr">pageSize:</span> <span class="number">10</span></span><br></pre></td></tr></tbody></table></figure>
<p>Or, if you need to make a quick change while in production, you can do so without having to rebuild and redeploy the application by setting the <code>taco.orders.pageSize</code> property as an environment variable: <code>export TACO_ORDERS_PAGESIZE=10</code>.</p>
<p>Any means by which a configuration property can be set can be used to adjust the page size of the recent orders page. Next, we’ll look at how to set configuration data in property holders.</p>
<h3 id="defining-configuration-properties-holders">Defining configuration properties holders</h3>
<p>There’s nothing that says <code>@ConfigurationProperties</code> must be set on a controller or any other specific kind of bean. <code>@ConfigurationProperties</code> are in fact often placed on beans whose sole purpose in the application is to be holders of configuration data. This keeps configuration-specific details out of the controllers and other application classes. It also makes it easy to share common configuration properties among several beans that may make use of that information.</p>
<p>In the case of the <code>pageSize</code> property in <code>OrderController</code>, you could extract it to a separate class. The following listing uses the <code>OrderProps</code> class in such a way.</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix="taco.orders")</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderProps</span> {</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Min(value=5, message="must be between 5 and 25")</span></span><br><span class="line">  <span class="meta">@Max(value=25, message="must be between 5 and 25")</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>As you did with <code>OrderController</code>, the <code>pageSize</code> property defaults to 20 and <code>OrderProps</code> is annotated with <code>@ConfigurationProperties</code> to have a prefix of <code>taco.orders</code> . It’s also annotated with <code>@Component</code>so that Spring component scanning will automatically discover it and create it as a bean in the Spring application context. This is important, as the next step is to inject the <code>OrderProps</code> bean into <code>OrderController</code>.</p>
<p>There’s nothing particularly special about configuration property holders. They’re beans that have their properties injected from the Spring environment. They can be injected into any other bean that needs those properties.</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping("/orders")</span></span><br><span class="line"><span class="meta">@SessionAttributes("order")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> {</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> OrderRepository orderRepo;</span><br><span class="line">    <span class="keyword">private</span> OrderProps props;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">OrderController</span><span class="params">(OrderRepository orderRepo,</span></span><br><span class="line"><span class="params">          OrderProps props)</span> {</span><br><span class="line">    <span class="built_in">this</span>.orderRepo = orderRepo;</span><br><span class="line">    <span class="built_in">this</span>.props = props;</span><br><span class="line">  }</span><br><span class="line">  ...</span><br><span class="line">  <span class="meta">@GetMapping</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">ordersForUser</span><span class="params">(<span class="meta">@AuthenticationPrincipal</span> User user, Model model)</span> {</span><br><span class="line">    <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(<span class="number">0</span>, props.getPageSize());</span><br><span class="line">    model.addAttribute(<span class="string">"orders"</span>,</span><br><span class="line">        orderRepo.findByUserOrderByPlacedAtDesc(user, pageable));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"orderList"</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">  </span><br></pre></td></tr></tbody></table></figure>
<p>Now <code>OrderController</code> is no longer responsible for handling its own configuration properties. This keeps the code in <code>OrderController</code> slightly neater and allows you to reuse the properties in <code>OrderProps</code> in any other bean that may need them. Moreover, you’re collecting configuration properties that pertain to orders in one place: the <code>OrderProps</code> class. If you need to add, remove, rename, or otherwise change the properties therein, you only need to apply those changes in <code>OrderProps</code>.</p>
<p>For example, let’s pretend that you’re using the <code>pageSize</code> property in several other beans when you decide it would be best to apply some validation to that property to limit its values to no less than 5 and no more than 25. Without a holder bean, you’d have to apply validation annotations to <code>OrderController</code>, the <code>pageSize</code> property, and all other classes using that property. But because you’ve extracted <code>pageSize</code> into <code>OrderProps</code>, you only must make the changes to <code>OrderProps</code>.</p>
<p>With a configuration property holder bean, you’ve collected configuration property specifics in one place, leaving the classes that need those properties relatively clean.</p>
<h3 id="declaring-configuration-property-metadata">Declaring configuration property metadata</h3>
<p>Depending on your IDE, you may have noticed that the <code>taco.orders.pageSize</code> entry in <code>application.yml</code> (or <code>application.properties</code>) has a warning saying something like Unknown Property ‘taco’. This warning appears because there’s missing metadata concerning the configuration property you just created.</p>
<p>To create metadata for your custom configuration properties, you’ll need to create a file under the <code>META-INF</code> (for example, in the project under <code>src/main/resources/ META-INF</code>) named <code>additional-spring-configuration-metadata.json</code>.</p>
<h2 id="configuring-with-profiles">Configuring with profiles</h2>
<p>When applications are deployed to different run-time environments, usually some configuration details differ. The details of a database connection, for instance, are likely not the same in a development environment as in a quality assurance environment, and different still in a production environment. One way to configure properties uniquely in one environment over another is to use environment variables to specify configuration properties instead of defining them in <code>application.properties</code> and <code>application.yml</code>.</p>
<p>Instead, I prefer to take advantage of Spring profiles. Profiles are a type of conditional configuration where different beans, configuration classes, and configuration properties are applied or ignored based on what profiles are active at runtime.</p>
<h3 id="defining-profile-specific-properties">Defining profile-specific properties</h3>
<p>One way to define profile-specific properties is to create yet another YAML or properties file containing only the properties for production. The name of the file should follow this convention: application-{profile name}.yml or application-{profile name}.properties. Then you can specify the configuration properties appropriate to that profile. For example, you could create a new file named application-prod.yml that contains the following properties:</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost/tacocloud</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">tacouser</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">tacopassword</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">tacos:</span> <span class="string">WARN</span></span><br></pre></td></tr></tbody></table></figure>
<p>Another way to specify profile-specific properties works only with YAML configuration. It involves placing profile-specific properties alongside non-profiled properties in <code>application.yml</code>, separated by three hyphens and the <code>spring.profiles</code> property to name the profile.</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">	<span class="attr">level:</span></span><br><span class="line">		<span class="attr">tacos:</span> <span class="string">DEBUG</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">prod</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost/tacocloud</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">tacouser</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">tacopassword</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">tacos:</span> <span class="string">WARN</span></span><br></pre></td></tr></tbody></table></figure>
<p>As you can see, this application.yml file is divided into two sections by a set of triple hyphens (---). The second section specifies a value for spring.profiles, indicating that the properties that follow apply to the prod profile. The first section, on the other hand, doesn’t specify a value for spring.profiles. Therefore, its properties are common to all profiles or are defaults if the active profile doesn’t otherwise have the properties set.</p>
<p>If the profile named prod is active, then the <code>logging.level</code>.tacos property will be overridden with <code>WARN</code>. Likewise, if the prod profile is active, then the data-source properties will be set to use the external MySQL database.</p>
<p>You can define properties for as many profiles as you need by creating additional YAML or properties files named with the pattern <code>application-{profile name}.yml</code> or <code>application-{profile name}.properties</code>.</p>
<p>I recommend that you set the active profile(s) with environment variables. On the production environment, you would set SPRING_PROFILES_ACTIVE like this: <code>export SPRING_PROFILES_ACTIVE=prod</code></p>
<p>. From then on, any applications deployed to that machine will have the prod profile active and the corresponding configuration properties would take precedence over the properties in the default profile.</p>
<p>Note that the spring.profiles.active property name contains the plural word profiles. This means you can specify more than one active profile. Often, this is with a comma-separated list as when setting it with an environment variable: <code>export SPRING_PROFILES_ACTIVE=prod,audit,ha</code>.</p>
<h3 id="conditionally-creating-beans-with-profiles">Conditionally creating beans with profiles</h3>
<p>Sometimes it’s useful to provide a unique set of beans for different profiles. Normally, any bean declared in a Java configuration class is created, regardless of which profile is active. But suppose there are some beans that you only need to be created if a certain profile is active. In that case, the <code>@Profile</code> annotation can designate beans as only being applicable to a given profile.</p>
<p>Or suppose that you need the CommandLineRunner created if either the dev profile or qa profile is active. In that case, you can list the profiles for which the bean should be created:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Profile({"dev", "qa"})</span> </span><br><span class="line"><span class="keyword">public</span> CommandLineRunner <span class="title function_">dataLoader</span><span class="params">(IngredientRepository repo, UserRepository userRepo, PasswordEncoder encoder)</span> {</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>Now the ingredient data will only be loaded if the dev or qa profiles are active.</p>
<p>It would be even more convenient if that CommandLineRunner bean were always created unless the prod profile is active. In that case, you can apply <code>@Profile</code> like this:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Profile("!prod")</span> </span><br><span class="line"><span class="keyword">public</span> CommandLineRunner <span class="title function_">dataLoader</span><span class="params">(IngredientRepository repo, UserRepository userRepo, PasswordEncoder encoder)</span> {</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>Effectively, it states that the CommandLineRunner bean will be created if the prod profile isn’t active.</p>
<p>It’s also possible to use <code>@Profile</code> on an entire <span class="citation" data-cites="Configuration-annotated">[@Configuration-annotated]</span> class. For example, suppose that you were to extract the CommandLineRunner bean into a separate configuration class named DevelopmentConfig. Then you could annotate DevelopmentConfig with <code>@Profile</code>:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Profile({"!prod", "!qa"})</span> </span><br><span class="line"><span class="meta">@Configuration</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DevelopmentConfig</span> {</span><br><span class="line">  <span class="meta">@Bean</span> </span><br><span class="line">  <span class="keyword">public</span> CommandLineRunner <span class="title function_">dataLoader</span><span class="params">(IngredientRepository repo, UserRepository userRepo, PasswordEncoder encoder)</span> {</span><br><span class="line">	...</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>Here, the CommandLineRunner bean (as well as any other beans defined in DevelopmentConfig ) will only be created if neither the <code>prod</code> nor <code>qa</code> profiles are active.</p>
<script type="text&#x2F;javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.7.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.7.0/dist/mindmap.min.css"></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/reading-notes/tags/software-dev/">software_dev</a><a class="post-meta__tags" href="/reading-notes/tags/spring/">spring</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/reading-notes/cqNotes/SoftwareDev/SpringInAction/spring-in-action-notes-04/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/reading-notes/default_cover/science-1182713_1920.jpg" onerror="onerror=null;src='/reading-notes/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Spring In Action Notes (4)</div></div></a></div><div class="next-post pull-right"><a href="/reading-notes/cqNotes/SoftwareDev/SpringInAction/spring-in-action-notes-02/"><img class="next-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/reading-notes/default_cover/leaves-4754980_1920.jpg" onerror="onerror=null;src='/reading-notes/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Spring In Action Notes (2)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/reading-notes/cqNotes/SoftwareDev/SpringInAction/spring-in-action-notes-07/" title="Spring In Action Notes (7)"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/reading-notes/default_cover/pi-1453836_1280.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-01</div><div class="title">Spring In Action Notes (7)</div></div></a></div><div><a href="/reading-notes/cqNotes/SoftwareDev/SpringInAction/spring-in-action-notes-06/" title="Spring In Action Notes (6)"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/reading-notes/default_cover/abstract-1264071.svg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-29</div><div class="title">Spring In Action Notes (6)</div></div></a></div><div><a href="/reading-notes/cqNotes/SoftwareDev/SpringInAction/spring-in-action-notes-04/" title="Spring In Action Notes (4)"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/reading-notes/default_cover/science-1182713_1920.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-28</div><div class="title">Spring In Action Notes (4)</div></div></a></div><div><a href="/reading-notes/cqNotes/SoftwareDev/SpringInAction/spring-in-action-notes-02/" title="Spring In Action Notes (2)"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/reading-notes/default_cover/leaves-4754980_1920.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-27</div><div class="title">Spring In Action Notes (2)</div></div></a></div><div><a href="/reading-notes/cqNotes/SoftwareDev/SpringInAction/spring-in-action-notes-01/" title="Spring In Action Reading Notes (1)"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/reading-notes/default_cover/museum-5431661_1280.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-26</div><div class="title">Spring In Action Reading Notes (1)</div></div></a></div><div><a href="/reading-notes/cqNotes/Java/cq_springboot/" title="cq_sprintboot"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/reading-notes/default_cover/science-1182713_1920.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-01</div><div class="title">cq_sprintboot</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ch6-working-with-configuration-properties"><span class="toc-number">1.</span> <span class="toc-text">Ch6 Working With Configuration Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#fine-tuning-autocnofiguration"><span class="toc-number">1.1.</span> <span class="toc-text">Fine-tuning autocnofiguration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#understanding-springs-environment-abstraction"><span class="toc-number">1.1.1.</span> <span class="toc-text">Understanding Spring’s environment abstraction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#configuring-a-data-source"><span class="toc-number">1.1.2.</span> <span class="toc-text">Configuring a data source</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#configuring-the-embedded-server"><span class="toc-number">1.1.3.</span> <span class="toc-text">Configuring the embedded server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#configuring-logging"><span class="toc-number">1.1.4.</span> <span class="toc-text">Configuring logging</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#using-special-property-values"><span class="toc-number">1.1.5.</span> <span class="toc-text">Using special property values</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#creating-your-own-confutation-properties"><span class="toc-number">1.2.</span> <span class="toc-text">Creating your own confutation properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#defining-configuration-properties-holders"><span class="toc-number">1.2.1.</span> <span class="toc-text">Defining configuration properties holders</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#declaring-configuration-property-metadata"><span class="toc-number">1.2.2.</span> <span class="toc-text">Declaring configuration property metadata</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#configuring-with-profiles"><span class="toc-number">1.3.</span> <span class="toc-text">Configuring with profiles</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#defining-profile-specific-properties"><span class="toc-number">1.3.1.</span> <span class="toc-text">Defining profile-specific properties</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#conditionally-creating-beans-with-profiles"><span class="toc-number">1.3.2.</span> <span class="toc-text">Conditionally creating beans with profiles</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="Increase font size"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="Decrease font size"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/reading-notes/js/utils.js"></script><script src="/reading-notes/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/reading-notes/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script></div></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>